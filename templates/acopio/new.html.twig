{% extends 'base.html.twig' %}
{% import 'macro/breadcrumb.html.twig' as breadcrumb %}
{% import 'macro/action.html.twig' as action %}


{% set _title = 'Acopio' %}
{% set _main_title = 'Nuevo' %}
{% set _section =  'acopio_index'%}

{% block _breadcrumb %}
    {{ breadcrumb.show2(_title,_section,'Nuevo') }}
{% endblock %}

{% form_theme form _self %}

{% block _main %}
    {{ include('acopio/_form.html.twig') }}
{% endblock %}

{% block _main_tools %}
    {% include 'crud/_tools_ico.html.twig' %}
{% endblock %}

{% block _body_tools %}
    {% include 'crud/_new_links_ico.html.twig' with {'route_base':'acopio'} %}
{% endblock %}

{% block _body_tools_ico %}
    {% include 'crud/_new_links_tool.html.twig' with {'route_base': 'acopio'}  %}
{% endblock %}

{% block _main_footer %}
    {% include 'crud/_new_links.html.twig' with {'route_base':'acopio'} %}
{% endblock %}

{% block _javascripts %}
    <script src = "{{ asset('js/select2.js') }}"></script>
    <script src = "{{ asset('js/flatpickr.js') }}" type="text/javascript"></script>
    <script>
        jQuery(document).ready(function (){
            Select2();
            Flatpickr();
            $('#acopio_fecha').flatpickr();
            $('#acopio_cantidad').keyup(function(){
                if($('#acopio_pesoBruto').empty()){
                    let $pesoBruto = $('#acopio_pesoBruto').val();
                    let $cantidad = $('#acopio_cantidad').val();
                    let $tara = $('#acopio_tara').val();

                    let $taraTotal = $tara * $cantidad;
                    // let $taraTotal = parseFloat($('#acopio_pesoBruto')) * parseFloat($('#acopio_cantidad'));
                    let $pesoNeto = $pesoBruto - $taraTotal;

                    // console.log($taraTotal)

                    $('#acopio_taraTotal').val($taraTotal);
                    $('#acopio_pesoNeto').val($pesoNeto)
                }
            })
            $('#acopio_socio').change(function(){
                let $this=$(this);
                let $periodo=$('#acopio_periodo').val();
                let $certificacion=$('#acopio_certificacion').val();
                console.log($this.val());
                $.ajax({
                    type:'POST',
                    url:'{{ path('estimacion_socio_ajax') }}',
                    data:{
                        idSocio:$this.val(),
                        idPeriodo:$periodo,
                        idCertificacion:$certificacion,
                    },
                    success:function (response){
                        if(!response.status){
                            Notify.warning(response.message)
                            return false
                        }
                        console.log(response.data);
                        let data=response.data;

                        // var table = document.getElementById("cuerpo_tabla_socio");//toma la tabla base
                        // var tablaAux = table
                        // var bTable = table.getElementsByTagName("tbody")
                        var row;
                        row = `
                            <tr>
                                <td>${data.estimacion[0].nombre}</td>
                                <td>${data.estimacion[0].cantidad}</td>
                                <td>Holi</td>
                                <td>Holi x2/td>
                            </tr>
                        `;
                        // table.appendChild(row)
                        //
                        // $('#tabla_socio').table(table);
                        // tablaAux.crea
                        // $("#cuerpo_tabla_socio").append(row)
                        if ($("#cuerpo_tabla_socio").empty()){
                            $("#cuerpo_tabla_socio").append(row)

                        }
                        else {
                            $("#cuerpo_tabla_socio").deleteRow(0)
                            $("#cuerpo_tabla_socio").append(row)
                        }

                        // console.log(data.estimacion[0].nombre);
                        // console.log(data.estimacion[0].cantidad);
                    }
                })
            })

        });
    </script>
{% endblock %}